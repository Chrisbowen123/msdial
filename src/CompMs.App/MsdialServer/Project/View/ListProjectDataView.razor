@using CompMs.App.MsdialServer.Project.Entity
@using CompMs.App.MsdialServer.Project.Model
@inject ProjectModel _project
@inject IListProjectDataViewModel _viewmodel

<MudButton Variant="Variant.Filled" OnClick="@((e) => _viewmodel.SearchEntriesAsync())">Search</MudButton>

<MudTable Items="@_viewmodel.Entries.Value" Hover="true" Breakpoint="Breakpoint.Sm" Height="320px">
    <ColGroup>
        <col/>
        <col style="width:100px"/>
    </ColGroup>
    <HeaderContent>
        <MudTh>Project</MudTh>
        <MudTh></MudTh>
    </HeaderContent>
    <RowTemplate>
        <MudTd DataLabel="Project">@context.Name</MudTd>
        <MudTd><MudButton Variant="Variant.Outlined" Size="Size.Small" OnClick="@((e) => LoadAsync(context))">Load</MudButton></MudTd>
    </RowTemplate>
</MudTable>

@code {
    [Parameter]
    public Action? OnLoaded { get; set; }

    async Task LoadAsync(ProjectDataFile projectDataFile) {
        await _project.LoadAsync(projectDataFile).ConfigureAwait(false);
        OnLoaded?.Invoke();
    }
}

